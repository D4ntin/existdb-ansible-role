# Custom Java options for this eXist-db instance
#
# pass each custom Java option on a separate line
# comments and whitespace lines get stripped before applying options

# HTTP/TLS ports
{% if exist_http_port > 0 %}
-Djetty.port={{ exist_http_port }}
{% else %}
#-Djetty.port=
{% endif %}
{% if exist_ssl_port > 0 %}
-Djetty.ssl.port={{ exist_ssl_port }}
{% else %}
#-Djetty.ssl.port=
{% endif %}

# initial and max Java heap memory
# set to same amount to improve G1GC region sizing
-Xms{{ exist_mem_init_heap }}m
-Xmx{{ exist_mem_max_heap }}m

# max Java metaspace and direct memory sizes
# if not limited, both default to -Xmx value
-XX:MaxMetaspaceSize={{ exist_mem_max_meta }}m
-XX:MaxDirectMemorySize={{ exist_mem_max_direct }}m

# GC (default G1 GC)
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
# GC logging/debugging
{% if exist_mem_gcdebug_enable == True %}
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-Xloggc:{{ exist_path }}/logs/gc-%t.log
{% else %}
#-XX:+PrintGCDetails
#-XX:+PrintGCDateStamps
#-Xloggc:{{ exist_path }}/logs/gc-%t.log
{% endif %}

# NMT (native memory tracking)
{% if exist_mem_nmt_enable == True %}
-XX:NativeMemoryTracking=summary
-XX:+UnlockDiagnosticVMOptions
-XX:+PrintNMTStatistics
{% else %}
#-XX:NativeMemoryTracking=summary
#-XX:+UnlockDiagnosticVMOptions
#-XX:+PrintNMTStatistics
{% endif %}

# string deduplication, requires Java >= 8u20 and G1 GC
{% if exist_mem_strdedup_enable == True %}
-XX:+UseStringDeduplication
-XX:+PrintStringDeduplicationStatistics
{% else %}
#-XX:+UseStringDeduplication
#-XX:+PrintStringDeduplicationStatistics
{% endif %}

# Java NIO cache tuning (256k) to work around high direct memory consumption
# by java.nio
# requires Java >= 8u102, should not be needed with Java 11
{% if exist_mem_niocachetune_enable == True %}
-Djdk.nio.maxCachedBufferSize=262144
{% else %}
#-Djdk.nio.maxCachedBufferSize=262144
{% endif %}

# tmp dir
-Djava.io.tmpdir={{ exist_home }}/tmp
